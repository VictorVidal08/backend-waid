# Boas vindas ao reposit√≥rio backend do projeto <b>Social Media</b>!

Esse projeto foi desenvolvido com o objetivo de simular uma rede social!!

## Tecnologias utilizadas:

- TypesCript;
- Node
- Express;
- Jwt (Json Web Token);
- Sequelize;
- MySql;
- Joi para valida√ß√µes.

---

# Funcionalidades do projeto:

CRUD √© um acr√¥nimo para **C**reate, **R**ead, **U**pdate and **D**elete. Em portugu√™s seria **Criar**, **Ler**, **Atualizar** e **Deletar** registros. Nesse projeto trabalhei diretamente com a manipula√ß√£o no banco de dados MySQL, utilizando do ORM Sequelize para a manipula√ß√£o do banco, onde est√£o registrados as tabelas de usu√°rios (Users) e seus respectivos posts (SocialPosts).

## Como rodar o projeto:

Clone a aplica√ß√£o com o comando: 
```
git clone git@github.com:VictorVidal08/backend-waid.git
```
Entre no diret√≥rio da aplica√ß√£o:
```
cd backend
```
Instale as depend√™ncias do projeto:
```
npm install
```
O projeto utiliza as portas 3306 (base de dados), 3001 para o backend 3000 para frontend. Estas portas precisam estar livres para que a aplica√ß√£o funcione.
### Subindo a base de dados:

Um arquivo .env deve ser criado na raiz da aplica√ß√£o com o seguinte conteudo:
```
MYSQL_USER=root
MYSQL_PASSWORD=senha_mysql
MYSQL_DATABASE=orm_social_media
MYSQL_HOST=localhost
JWT_SECRET=jwt_pepper
```
Caso n√£o tenha o MySql instalado, √© possivel subir um container com o comando:
```
docker container run --name waid-db-mysql -e MYSQL_ROOT_PASSWORD=senha_mysql -d -p 3306:3306 mysql:8.0.29
```

Para Criar as tabelas e popular com os dados iniciais, √© necess√°rio rodar os comandos abaixo:
```
npx sequelize db:create

npx sequelize db:migrate

npx sequelize db:seed:all
```
### Para rodar o projeto:

execute o comando abaixo para rodar a aplica√ß√£o em modo de desenvolvedor: 
```
npm run dev
```
---
## **Requisitos:**

### Registrar

    ‚Ä¢ Um usu√°rio DEVE poder se registrar usando nome, email e senha

### Login

    ‚Ä¢ O email DEVE ser √∫nico por usu√°rio
    ‚Ä¢ Um usu√°rio DEVE poder fazer login com email e senha

### Listar postagens

    ‚Ä¢ Um usu√°rio logado DEVE poder visualizar o feed de postagens

### Criar postagem

    ‚Ä¢ Um usu√°rio logado DEVE poder criar postagens

### Editar postagem

    ‚Ä¢ Um usu√°rio logado DEVE poder editar suas pr√≥prias postagens
    ‚Ä¢ Um usu√°rio N√ÉO DEVE poder editar postagens de outros usu√°rios

### Remover postagem

    ‚Ä¢ Um usu√°rio logado DEVE poder remover suas pr√≥prias postagens
    ‚Ä¢ Um usu√°rio N√ÉO DEVE poder remover postagens de outros usu√°rios

---

## üìö Documenta√ß√£o (endpoints)
## Users:
### Login:

| M√©todo | Funcionalidade           | URL                         |
| ------ | ------------------------ | --------------------------- |
| `POST` | Realiza login no backend | http://localhost:3001/login |

<details>
  <summary>A estrutura do <code>body</code> da requisi√ß√£o dever√° seguir o padr√£o abaixo:</summary>

```json
{
  "email": "lewishamilton@gmail.com",
  "password": "123456"
}
```

</details>

<details>
  <summary>A resposta da requisi√ß√£o √© a seguinte, com status 200:</summary>

```json
{
  "email": "lewishamilton@gmail.com",
  "password": "123456",
  "image": "https://upload.wikimedia.org/wikipedia/commons/1/18/Lewis_Hamilton_2016_Malaysia_2.jpg",
  "id": 1,
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6eyJlbWFpbCI6Imxld2lzaGFtaWx0b25AZ21haWwuY29tIn0sImlhdCI6MTY3MDUxMjA1NCwiZXhwIjoxNjcxMTE2ODU0fQ.x3i5WaQJNbI3NfCy6iQXqBUOe5sIBhA44j0rcEKu8vU"
}
```
</details>

<details>
  <summary>A requisi√ß√£o ir√° falhar nos seguintes casos:</summary>
  - A rota retorna o c√≥digo <code>400</code>, com a mensagem <code>Some required fields are missing</code> caso alguma informa√ß√£o esteja faltando no body da requisi√ß√£o;<br>
  - A rota retorna o c√≥digo <code>401</code>, com a mensagem <code>Incorrect username or password</code> caso alguma informa√ß√£o seja inv√°lida no body da requisi√ß√£o.
</details>
<br>

### Registrar novo usu√°rio:

| M√©todo | Funcionalidade                             | URL                        |
| ------ | ------------------------------------------ | -------------------------- |
| `POST` | Adiciona um novo usu√°rio no banco de dados | http://localhost:3001/user |

<details>
  <summary>A estrutura do <code>body</code> da requisi√ß√£o dever√° seguir o padr√£o abaixo:</summary>

```json
{
  "displayName": "Brett Wiltshire",
  "email": "brett@email.com",
  "password": "123456",
  "image": "http://4.bp.blogspot.com/_YA50adQ-7vQ/S1gfR_6ufpI/AAAAAAAAAAk/1ErJGgRWZDg/S45/brett.png"
}
```

</details>

<details>
  <summary>A resposta da requisi√ß√£o √© a seguinte, com status 201:</summary>

```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJwYXlsb2FkIjp7ImlkIjo1LCJkaXNwbGF5TmFtZSI6InVzdWFyaW8gZGUgdGVzdGUiLCJlbWFpbCI6InRlc3RlQGVtYWlsLmNvbSIsImltYWdlIjoibnVsbCJ9LCJpYXQiOjE2MjAyNDQxODcsImV4cCI6MTYyMDY3NjE4N30.Roc4byj6mYakYqd9LTCozU1hd9k_Vw5IWKGL4hcCVG8"
}
```

</details>

<details>
  <summary>A requisi√ß√£o ir√° falhar nos seguintes casos:</summary>
  - A rota retorna o c√≥digo <code>400</code>, com a mensagem <code>"userName" length must be at least 3 characters long</code> caso o campo displayName tenha menos de 3 caracteres body da requisi√ß√£o;<br>
  - A rota retorna o c√≥digo <code>400</code>, com a mensagem <code>"email" must be a valid email</code> caso o campo displayName tenha menos de 3 caracteres body da requisi√ß√£o;<br>
  - A rota retorna o c√≥digo <code>400</code>, com a mensagem <code>"password" length must be at least 6 characters long</code> caso o campo password tenha menos de 6 caracteres body da requisi√ß√£o;<br>
  - A rota retorna o c√≥digo <code>409</code>, com a mensagem <code>User already registered</code> caso o usu√°rio j√° exista no banco de dados.
</details>
<br>

## ‚ö†Ô∏è‚ö†Ô∏è Validando token nas requisi√ß√µes ‚ö†Ô∏è‚ö†Ô∏è

Todos endpoints abaixo devem respeitar a regra de autentica√ß√£o (login). Assim sendo, todas as requisi√ß√µes abaixo devem, obrigatoriamente, ter um `token de autentica√ß√£o` nos headers, no campo `authorization` (obtido ap√≥s realizar o login ou cadastrar um usu√°rio).
### Listar usu√°rios:

| M√©todo | Funcionalidade                            | URL                        |
| ------ | ----------------------------------------- | -------------------------- |
| `GET`  | Retorna uma lista de usu√°rios cadastrados | http://localhost:3001/user |

<details>
  <summary>A resposta da requisi√ß√£o √© a seguinte, com status 200:</summary>

```json
[
  {
      "id": 1,
      "displayName": "Lewis Hamilton",
      "email": "lewishamilton@gmail.com",
      "image": "https://upload.wikimedia.org/wikipedia/commons/1/18/Lewis_Hamilton_2016_Malaysia_2.jpg"
  },

  /* ... */
]
```

</details>
<br>

## Posts:
### Listar todos os Posts:

| M√©todo | Funcionalidade                            | URL                        |
| ------ | ----------------------------------------- | -------------------------- |
| `GET`  | Retorna uma lista de postagens realizadas | http://localhost:3001/posts |

<details>
  <summary>A resposta da requisi√ß√£o √© a seguinte, com status 200:</summary>

```json
[
  {
    "id": 1,
    "title": "Post do Ano",
    "content": "Melhor post do ano",
    "userId": 1,
    "published": "2022-12-07T16:43:36.000Z",
    "updated": "2022-12-07T16:43:36.000Z",
    "user": {
      "id": 1,
      "userName": "Lewis Hamilton",
      "email": "lewishamilton@gmail.com",
      "image": "https://upload.wikimedia.org/wikipedia/commons/1/18/Lewis_Hamilton_2016_Malaysia_2.jpg"
    }
  },
  
  /* ... */
]
```

</details>
<br>

### Cadastrando novo post


| M√©todo | Funcionalidade                               | URL                        |
| ------ | -------------------------------------------- | -------------------------- |
| `POST` | Adiciona uma nova postagem ao banco de dados | http://localhost:3001/post |

<details>
  <summary>A estrutura do <code>body</code> da requisi√ß√£o dever√° seguir o padr√£o abaixo:</summary>

```json
{
  "title": "Latest updates, December 7",
  "content": "The whole text for the blog post goes here in this key",
  "userId": 2
}
```

</details>

<details>
  <summary>A resposta da requisi√ß√£o √© a seguinte, com status 201:</summary>

```json
{
  "id": 3,
  "title": "Latest updates, December 7",
  "content": "The whole text for the blog post goes here in this key",
  "userId": 2,
  "updated": "2022-12-18T18:00:01.196Z",
  "published": "2022-12-18T18:00:01.196Z"
}
```

</details>

### Editando postagem:

| M√©todo | Funcionalidade                                                                                            | URL                            |
| ------ | --------------------------------------------------------------------------------------------------------- | ------------------------------ |
| `PATCH`  | Permite que o usu√°rio logado atualize uma postagem dele no banco de dados (substitua `:id` por um n√∫mero) | http://localhost:3001/post/:id |

<details>
  <summary>A estrutura do <code>body</code> da requisi√ß√£o dever√° seguir o padr√£o abaixo:</summary>

```json
{
  "title": "Latest updates, December 7",
  "content": "The whole text for the blog post goes here in this key"
}
```

</details>

<details>
  <summary>A resposta da requisi√ß√£o √© a seguinte, com status 200:</summary>

```json
{
  "id": 3,
  "title": "Latest updates, December 7",
  "content": "The whole text for the blog post goes here in this key",
  "userId": 1,
  "published": "2022-12-18T18:00:01.000Z",
  "updated": "2022-12-18T18:07:32.000Z",
  "user": {
    "id": 1,
    "displayName": "Lewis Hamilton",
    "email": "lewishamilton@gmail.com",
    "image": "https://upload.wikimedia.org/wikipedia/commons/1/18/Lewis_Hamilton_2016_Malaysia_2.jpg"
  },
}
```

</details>

### Removendo postagem:

| M√©todo   | Funcionalidade                                                                                          | URL                            |
| -------- | ------------------------------------------------------------------------------------------------------- | ------------------------------ |
| `DELETE` | Permite que o usu√°rio logado delete uma postagem dele no banco de dados (substitua `:id` por um n√∫mero) | http://localhost:3001/post/:id |

A rota retorna o status 204, <code>'Post deleted successfully'</code>.

---

## Pr√≥ximos passos:

Usar BCrypt para criptografia de senha do usu√°rio.
Implementa√ß√£o de testes.
